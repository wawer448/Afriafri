<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecospatial CMS - Secure Admin Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1a365d;
            --secondary: #2c5282;
            --accent: #00d4ff;
            --dark: #0f172a;
            --light: #f8fafc;
            --white: #ffffff;
            --gray: #64748b;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --gradient: linear-gradient(135deg, #1a365d 0%, #2c5282 50%, #00d4ff 100%);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--light);
            color: var(--dark);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Login Screen */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gradient);
            position: relative;
            overflow: hidden;
        }

        .login-container::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: float 20s linear infinite;
        }

        @keyframes float {
            0% { transform: translateY(0); }
            100% { transform: translateY(-50px); }
        }

        .login-box {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 3rem;
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
            width: 90%;
            max-width: 400px;
            position: relative;
            z-index: 1;
        }

        .login-box h2 {
            text-align: center;
            margin-bottom: 2rem;
            font-size: 2rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* CMS Layout */
        .cms-container {
            display: none;
            min-height: 100vh;
        }

        .cms-header {
            background: var(--white);
            box-shadow: var(--shadow);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .header-left h1 {
            font-size: 1.5rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .cms-body {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid #e2e8f0;
        }

        .tab {
            padding: 1rem 2rem;
            background: none;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray);
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: var(--primary);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--accent);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Cards */
        .card {
            background: var(--white);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--dark);
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.9rem;
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
            background: var(--light);
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--accent);
            background: var(--white);
            box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.1);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* Buttons */
        .btn {
            background: var(--gradient);
            color: var(--white);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .btn-secondary {
            background: var(--gray);
        }

        .btn-success {
            background: var(--success);
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        /* Carousel Manager */
        .carousel-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .carousel-item {
            background: var(--light);
            border-radius: 12px;
            padding: 1.5rem;
            border: 2px dashed #e2e8f0;
            position: relative;
            transition: all 0.3s ease;
        }

        .carousel-item:hover {
            border-color: var(--accent);
            background: var(--white);
        }

        .carousel-preview {
            width: 100%;
            height: 150px;
            background-size: cover;
            background-position: center;
            border-radius: 8px;
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
        }

        .carousel-preview::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, transparent, rgba(0,0,0,0.5));
        }

        .carousel-number {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--accent);
            color: var(--dark);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            z-index: 1;
        }

        /* Status Messages */
        .status {
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            display: none;
            align-items: center;
            gap: 0.5rem;
        }

        .status.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
        }

        .status.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .status.show {
            display: flex;
        }

        /* Preview */
        .preview-frame {
            width: 100%;
            height: 600px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            background: var(--white);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .cms-header {
                padding: 1rem;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .carousel-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Loading Spinner */
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--accent);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-container" id="loginScreen">
        <div class="login-box">
            <h2>üîê Ecospatial CMS</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="Enter admin password">
                </div>
                <button type="submit" class="btn" style="width: 100%;">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
            </form>
            <p style="text-align: center; margin-top: 1rem; color: var(--gray); font-size: 0.875rem;">
                Secure Admin Access
            </p>
        </div>
    </div>

    <!-- CMS Interface -->
    <div class="cms-container" id="cmsInterface">
        <!-- Header -->
        <header class="cms-header">
            <div class="header-content">
                <div class="header-left">
                    <h1>üèóÔ∏è Ecospatial CMS</h1>
                    <span style="color: var(--gray);">Content Management System</span>
                </div>
                <div>
                    <button class="btn btn-secondary btn-small" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="cms-body">
            <!-- Status Message -->
            <div class="status" id="statusMessage">
                <i class="fas fa-check-circle"></i>
                <span id="statusText"></span>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" onclick="switchTab('carousel')">
                    <i class="fas fa-images"></i> Carousel Manager
                </button>
                <button class="tab" onclick="switchTab('content')">
                    <i class="fas fa-edit"></i> Content Editor
                </button>
                <button class="tab" onclick="switchTab('preview')">
                    <i class="fas fa-eye"></i> Preview
                </button>
            </div>

            <!-- Carousel Tab -->
            <div class="tab-content active" id="carouselTab">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üé† Hero Carousel Images</h3>
                        <button class="btn btn-success btn-small" onclick="downloadCarousel()">
                            <i class="fas fa-download"></i> Download Changes
                        </button>
                    </div>
                    
                    <div class="carousel-grid">
                        <!-- Slide 1 -->
                        <div class="carousel-item">
                            <div class="carousel-number">1</div>
                            <div class="carousel-preview" id="preview1" style="background-image: url('https://images.unsplash.com/photo-1489392191049-fc10c97e64b6?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80');"></div>
                            <div class="form-group">
                                <label class="form-label">Image URL</label>
                                <input type="url" class="form-input" id="carouselImage1" 
                                       value="https://images.unsplash.com/photo-1489392191049-fc10c97e64b6?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80"
                                       onchange="updateCarouselPreview(1)">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Heading</label>
                                <input type="text" class="form-input" id="carouselHeading1" 
                                       value="Secure Your Land Investment Today">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Description</label>
                                <textarea class="form-textarea" id="carouselDesc1">Professional land surveying services to protect your property rights and maximize your investment value</textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Button Text</label>
                                <input type="text" class="form-input" id="carouselBtn1" 
                                       value="Get Free Consultation">
                            </div>
                        </div>

                        <!-- Slide 2 -->
                        <div class="carousel-item">
                            <div class="carousel-number">2</div>
                            <div class="carousel-preview" id="preview2" style="background-image: url('https://images.unsplash.com/photo-1516026672322-bc52d61a55d5?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80');"></div>
                            <div class="form-group">
                                <label class="form-label">Image URL</label>
                                <input type="url" class="form-input" id="carouselImage2" 
                                       value="https://images.unsplash.com/photo-1516026672322-bc52d61a55d5?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80"
                                       onchange="updateCarouselPreview(2)">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Heading</label>
                                <input type="text" class="form-input" id="carouselHeading2" 
                                       value="Fast & Accurate Title Deed Processing">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Description</label>
                                <textarea class="form-textarea" id="carouselDesc2">Get your land documentation completed in record time with our expert surveying and legal support</textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Button Text</label>
                                <input type="text" class="form-input" id="carouselBtn2" 
                                       value="Start Your Survey">
                            </div>
                        </div>

                        <!-- Slide 3 -->
                        <div class="carousel-item">
                            <div class="carousel-number">3</div>
                            <div class="carousel-preview" id="preview3" style="background-image: url('https://images.unsplash.com/photo-1569163139394-de4798a9c2b6?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80');"></div>
                            <div class="form-group">
                                <label class="form-label">Image URL</label>
                                <input type="url" class="form-input" id="carouselImage3" 
                                       value="https://images.unsplash.com/photo-1569163139394-de4798a9c2b6?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80"
                                       onchange="updateCarouselPreview(3)">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Heading</label>
                                <input type="text" class="form-input" id="carouselHeading3" 
                                       value="Trusted by 500+ Property Owners">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Description</label>
                                <textarea class="form-textarea" id="carouselDesc3">Join hundreds of satisfied clients who have secured their land investments with our certified survey services</textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Button Text</label>
                                <input type="text" class="form-input" id="carouselBtn3" 
                                       value="Book Appointment">
                            </div>
                        </div>

                        <!-- Slide 4 -->
                        <div class="carousel-item">
                            <div class="carousel-number">4</div>
                            <div class="carousel-preview" id="preview4" style="background-image: url('https://images.unsplash.com/photo-1611348524140-53c9914707fc?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80');"></div>
                            <div class="form-group">
                                <label class="form-label">Image URL</label>
                                <input type="url" class="form-input" id="carouselImage4" 
                                       value="https://images.unsplash.com/photo-1611348524140-53c9914707fc?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80"
                                       onchange="updateCarouselPreview(4)">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Heading</label>
                                <input type="text" class="form-input" id="carouselHeading4" 
                                       value="Subdivision & Development Planning">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Description</label>
                                <textarea class="form-textarea" id="carouselDesc4">Transform your land into profitable ventures with our comprehensive subdivision and planning services</textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Button Text</label>
                                <input type="text" class="form-input" id="carouselBtn4" 
                                       value="Discuss Your Project">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Tab -->
            <div class="tab-content" id="contentTab">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìù General Content</h3>
                        <button class="btn btn-success btn-small" onclick="downloadContent()">
                            <i class="fas fa-download"></i> Download Changes
                        </button>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Company Name</label>
                        <input type="text" class="form-input" id="companyName" value="Ecospatial Limited Solutions">
                    </div>

                    <div class="form-group">
                        <label class="form-label">About Text - Paragraph 1</label>
                        <textarea class="form-textarea" id="aboutText1">Ecospatial Limited Solutions is a leading land survey and physical planning consultancy firm dedicated to providing innovative spatial solutions. With years of experience in the industry, we combine cutting-edge technology with professional expertise to deliver accurate and reliable services.</textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">About Text - Paragraph 2</label>
                        <textarea class="form-textarea" id="aboutText2">Our team of qualified surveyors and planners is committed to excellence, ensuring that every project meets the highest standards of quality and precision. We pride ourselves on our attention to detail and our ability to provide customized solutions that meet our clients' unique needs.</textarea>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìû Contact Information</h3>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Location</label>
                        <input type="text" class="form-input" id="location" value="Nairobi, Kenya">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Phone Number</label>
                        <input type="text" class="form-input" id="phone" value="+254 722 804 316">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" class="form-input" id="email" value="pwaweru05@gmail.com">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Business Hours</label>
                        <input type="text" class="form-input" id="hours" value="Mon - Fri: 8:00 AM - 5:00 PM">
                    </div>
                </div>
            </div>

            <!-- Preview Tab -->
            <div class="tab-content" id="previewTab">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üëÅÔ∏è Live Preview</h3>
                        <div>
                            <button class="btn btn-small" onclick="refreshPreview()">
                                <i class="fas fa-sync"></i> Refresh
                            </button>
                            <button class="btn btn-success btn-small" onclick="exportChanges()">
                                <i class="fas fa-download"></i> Export Changes
                            </button>
                        </div>
                    </div>
                    
                    <iframe id="previewFrame" class="preview-frame" src="index.html"></iframe>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Security: Secure password protection
        const ADMIN_PASSWORD = 'Afri@7553';
        let isAuthenticated = false;

        // Check authentication
        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const password = document.getElementById('loginPassword').value;
            
            if (password === ADMIN_PASSWORD) {
                isAuthenticated = true;
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('cmsInterface').style.display = 'block';
                loadSavedData();
                showStatus('Login successful!', 'success');
            } else {
                showStatus('Invalid password!', 'error');
            }
        });

        // Logout function
        function logout() {
            isAuthenticated = false;
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('cmsInterface').style.display = 'none';
            document.getElementById('loginPassword').value = '';
        }

        // Tab switching
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            if (tabName === 'preview') {
                refreshPreview();
            }
        }

        // Update carousel preview
        function updateCarouselPreview(slideNumber) {
            const imageUrl = document.getElementById(`carouselImage${slideNumber}`).value;
            document.getElementById(`preview${slideNumber}`).style.backgroundImage = `url('${imageUrl}')`;
        }

        // Load saved data
        function loadSavedData() {
            const savedData = localStorage.getItem('ecospatialCMSData');
            if (savedData) {
                const data = JSON.parse(savedData);
                
                // Load carousel data
                for (let i = 1; i <= 4; i++) {
                    if (data[`carouselImage${i}`]) document.getElementById(`carouselImage${i}`).value = data[`carouselImage${i}`];
                    if (data[`carouselHeading${i}`]) document.getElementById(`carouselHeading${i}`).value = data[`carouselHeading${i}`];
                    if (data[`carouselDesc${i}`]) document.getElementById(`carouselDesc${i}`).value = data[`carouselDesc${i}`];
                    if (data[`carouselBtn${i}`]) document.getElementById(`carouselBtn${i}`).value = data[`carouselBtn${i}`];
                    updateCarouselPreview(i);
                }
                
                // Load content data
                const contentFields = ['companyName', 'aboutText1', 'aboutText2', 'location', 'phone', 'email', 'hours'];
                contentFields.forEach(field => {
                    if (data[field] && document.getElementById(field)) {
                        document.getElementById(field).value = data[field];
                    }
                });
            }
        }

        // Download carousel data
        function downloadCarousel() {
            try {
                const data = {};
                
                // Gather carousel data with validation
                for (let i = 1; i <= 4; i++) {
                    const imageInput = document.getElementById(`carouselImage${i}`);
                    const headingInput = document.getElementById(`carouselHeading${i}`);
                    const descInput = document.getElementById(`carouselDesc${i}`);
                    const btnInput = document.getElementById(`carouselBtn${i}`);
                    
                    if (!imageInput || !headingInput || !descInput || !btnInput) {
                        throw new Error(`Missing form elements for slide ${i}`);
                    }
                    
                    data[`carouselImage${i}`] = imageInput.value.trim();
                    data[`carouselHeading${i}`] = headingInput.value.trim();
                    data[`carouselDesc${i}`] = descInput.value.trim();
                    data[`carouselBtn${i}`] = btnInput.value.trim();
                }
                
                // Create downloadable JSON file
                const jsonData = JSON.stringify(data, null, 2);
                const blob = new Blob([jsonData], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `carousel-data-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showStatus('Carousel data downloaded successfully!', 'success');
                console.log('Carousel data downloaded:', data);
                
            } catch (error) {
                console.error('Error downloading carousel data:', error);
                showStatus('Error downloading carousel data: ' + error.message, 'error');
            }
        }

        // Download content data
        function downloadContent() {
            try {
                const data = {};
                
                // Gather content data with validation
                const contentFields = ['companyName', 'aboutText1', 'aboutText2', 'location', 'phone', 'email', 'hours'];
                contentFields.forEach(field => {
                    const element = document.getElementById(field);
                    if (!element) {
                        throw new Error(`Missing form element: ${field}`);
                    }
                    data[field] = element.value.trim();
                });
                
                // Create downloadable JSON file
                const jsonData = JSON.stringify(data, null, 2);
                const blob = new Blob([jsonData], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `content-data-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showStatus('Content data downloaded successfully!', 'success');
                console.log('Content data downloaded:', data);
                
            } catch (error) {
                console.error('Error downloading content data:', error);
                showStatus('Error downloading content data: ' + error.message, 'error');
            }
        }

        // Update live website with changes
        function updateLiveWebsite(data) {
            try {
                // Generate and execute update script immediately
                const updateScript = generateCarouselUpdates(data) + generateContentUpdates(data);
                
                // Try to update parent window if CMS is in iframe or popup
                if (window.opener && !window.opener.closed) {
                    const script = window.opener.document.createElement('script');
                    script.textContent = `(function() { ${updateScript} })();`;
                    window.opener.document.head.appendChild(script);
                    setTimeout(() => window.opener.document.head.removeChild(script), 100);
                }
                
                // Also update preview iframe if it exists
                const previewFrame = document.getElementById('previewFrame');
                if (previewFrame && previewFrame.contentWindow) {
                    try {
                        const script = previewFrame.contentDocument.createElement('script');
                        script.textContent = `(function() { ${updateScript} })();`;
                        previewFrame.contentDocument.head.appendChild(script);
                        setTimeout(() => previewFrame.contentDocument.head.removeChild(script), 100);
                    } catch (e) {
                        console.log('Could not update preview frame:', e.message);
                    }
                }
                
                console.log('Live website update attempted');
                
            } catch (error) {
                console.error('Error updating live website:', error);
            }
        }

        // Show status message
        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            const statusText = document.getElementById('statusText');
            
            statusText.textContent = message;
            statusDiv.className = `status ${type} show`;
            
            if (type === 'success') {
                statusDiv.innerHTML = '<i class="fas fa-check-circle"></i> ' + message;
            } else {
                statusDiv.innerHTML = '<i class="fas fa-exclamation-circle"></i> ' + message;
            }
            
            setTimeout(() => {
                statusDiv.classList.remove('show');
            }, 3000);
        }

        // Refresh preview
        function refreshPreview() {
            const iframe = document.getElementById('previewFrame');
            iframe.src = iframe.src;
        }

        // Export changes with multiple options
        function exportChanges() {
            try {
                // Gather all current form data instead of relying on localStorage
                const data = {};
                
                // Gather carousel data
                for (let i = 1; i <= 4; i++) {
                    const imageInput = document.getElementById(`carouselImage${i}`);
                    const headingInput = document.getElementById(`carouselHeading${i}`);
                    const descInput = document.getElementById(`carouselDesc${i}`);
                    const btnInput = document.getElementById(`carouselBtn${i}`);
                    
                    if (imageInput) data[`carouselImage${i}`] = imageInput.value.trim();
                    if (headingInput) data[`carouselHeading${i}`] = headingInput.value.trim();
                    if (descInput) data[`carouselDesc${i}`] = descInput.value.trim();
                    if (btnInput) data[`carouselBtn${i}`] = btnInput.value.trim();
                }
                
                // Gather content data
                const contentFields = ['companyName', 'aboutText1', 'aboutText2', 'location', 'phone', 'email', 'hours'];
                contentFields.forEach(field => {
                    const element = document.getElementById(field);
                    if (element) {
                        data[field] = element.value.trim();
                    }
                });
                
                // Show export options
                const choice = confirm(
                    'Choose export format:\n\n' +
                    'OK = Download updated index.html file (Recommended)\n' +
                    'Cancel = Download JavaScript update script'
                );
                
                if (choice) {
                    exportUpdatedHTML(data);
                } else {
                    exportUpdateScript(data);
                }
                
            } catch (error) {
                console.error('Export error:', error);
                showStatus('Error exporting changes: ' + error.message, 'error');
            }
        }

        // Export complete updated HTML file
        function exportUpdatedHTML(data) {
            try {
                // Generate the complete HTML with all changes applied
                const updatedHTML = generateUpdatedHTML(data);
                
                const blob = new Blob([updatedHTML], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'index.html';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showStatus('Updated index.html downloaded! Replace your current index.html with this file.', 'success');
                
            } catch (error) {
                console.error('HTML export error:', error);
                showStatus('Error exporting HTML: ' + error.message, 'error');
            }
        }

        // Export JavaScript update script (fallback)
        function exportUpdateScript(data) {
            try {
                const updateScript = `
// Ecospatial CMS Update Script
// Generated on: ${new Date().toLocaleString()}

// This script updates your website with CMS changes
// Add this to your index.html or run it in the console

(function() {
    // Carousel Updates
    ${generateCarouselUpdates(data)}
    
    // Content Updates
    ${generateContentUpdates(data)}
    
    console.log('Website updated successfully!');
})();
`;

                const blob = new Blob([updateScript], { type: 'text/javascript' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'ecospatial-updates.js';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showStatus('Update script exported! Add it to your website to apply changes.', 'success');
                
            } catch (error) {
                console.error('Script export error:', error);
                showStatus('Error exporting script: ' + error.message, 'error');
            }
        }

        // Generate complete updated HTML file
        function generateUpdatedHTML(data) {
            // Get current data or use defaults
            const companyName = data.companyName || 'Ecospatial Limited Solutions';
            const aboutText1 = data.aboutText1 || 'Ecospatial Limited Solutions is a leading land survey and physical planning consultancy firm dedicated to providing innovative spatial solutions. With years of experience in the industry, we combine cutting-edge technology with professional expertise to deliver accurate and reliable services.';
            const aboutText2 = data.aboutText2 || 'Our team of qualified surveyors and planners is committed to excellence, ensuring that every project meets the highest standards of quality and precision. We pride ourselves on our attention to detail and our ability to provide customized solutions that meet our clients\' unique needs.';
            const location = data.location || 'Nairobi, Kenya';
            const phone = data.phone || '+254 722 804 316';
            const email = data.email || 'pwaweru05@gmail.com';
            const hours = data.hours || 'Mon - Fri: 8:00 AM - 5:00 PM';
            
            // Generate carousel slides
            const slide1 = {
                image: data.carouselImage1 || 'https://images.unsplash.com/photo-1489392191049-fc10c97e64b6?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80',
                heading: data.carouselHeading1 || 'Secure Your Land Investment Today',
                desc: data.carouselDesc1 || 'Professional land surveying services to protect your property rights and maximize your investment value',
                btn: data.carouselBtn1 || 'Get Free Consultation'
            };
            
            const slide2 = {
                image: data.carouselImage2 || 'https://images.unsplash.com/photo-1516026672322-bc52d61a55d5?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80',
                heading: data.carouselHeading2 || 'Fast & Accurate Title Deed Processing',
                desc: data.carouselDesc2 || 'Get your land documentation completed in record time with our expert surveying and legal support',
                btn: data.carouselBtn2 || 'Start Your Survey'
            };
            
            const slide3 = {
                image: data.carouselImage3 || 'https://images.unsplash.com/photo-1569163139394-de4798a9c2b6?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80',
                heading: data.carouselHeading3 || 'Trusted by 500+ Property Owners',
                desc: data.carouselDesc3 || 'Join hundreds of satisfied clients who have secured their land investments with our certified survey services',
                btn: data.carouselBtn3 || 'Book Appointment'
            };
            
            const slide4 = {
                image: data.carouselImage4 || 'https://images.unsplash.com/photo-1611348524140-53c9914707fc?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80',
                heading: data.carouselHeading4 || 'Subdivision & Development Planning',
                desc: data.carouselDesc4 || 'Transform your land into profitable ventures with our comprehensive subdivision and planning services',
                btn: data.carouselBtn4 || 'Discuss Your Project'
            };

            return '<!DOCTYPE html>' +
'<html lang="en">' +
'<head>' +
'    <meta charset="UTF-8">' +
'    <meta name="viewport" content="width=device-width, initial-scale=1.0">' +
'    <title>' + companyName + ' - Land Survey & Physical Planning</title>' +
'    <link rel="stylesheet" href="css/styles.css">' +
'    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">' +
'</head>' +
'<body>' +
'    <!-- Header Section -->' +
'    <header>' +
'        <nav class="navbar">' +
'            <div class="container">' +
'                <div class="nav-brand">' +
'                    <h1>' + companyName + '</h1>' +
'                </div>' +
'                <ul class="nav-menu">' +
'                    <li><a href="#home">Home</a></li>' +
'                    <li><a href="#services">Services</a></li>' +
'                    <li><a href="#about">About</a></li>' +
'                    <li><a href="#contact">Contact</a></li>' +
'                </ul>' +
'                <div class="hamburger">' +
'                    <span></span>' +
'                    <span></span>' +
'                    <span></span>' +
'                </div>' +
'            </div>' +
'        </nav>' +
'    </header>' +

'    <!-- Hero Section -->' +
'    <section id="home" class="hero">' +
'        <div class="hero-carousel">' +
'            <div class="carousel-slide active" style="background-image: url(\'' + slide1.image + '\');">' +
'                <div class="carousel-overlay"></div>' +
'                <div class="hero-content">' +
'                    <h2>' + slide1.heading + '</h2>' +
'                    <p>' + slide1.desc + '</p>' +
'                    <a href="#contact" class="btn btn-primary">' + slide1.btn + '</a>' +
'                </div>' +
'            </div>' +
'            <div class="carousel-slide" style="background-image: url(\'' + slide2.image + '\');">' +
'                <div class="carousel-overlay"></div>' +
'                <div class="hero-content">' +
'                    <h2>' + slide2.heading + '</h2>' +
'                    <p>' + slide2.desc + '</p>' +
'                    <a href="#contact" class="btn btn-primary">' + slide2.btn + '</a>' +
'                </div>' +
'            </div>' +
'            <div class="carousel-slide" style="background-image: url(\'' + slide3.image + '\');">' +
'                <div class="carousel-overlay"></div>' +
'                <div class="hero-content">' +
'                    <h2>' + slide3.heading + '</h2>' +
'                    <p>' + slide3.desc + '</p>' +
'                    <a href="#contact" class="btn btn-primary">' + slide3.btn + '</a>' +
'                </div>' +
'            </div>' +
'            <div class="carousel-slide" style="background-image: url(\'' + slide4.image + '\');">' +
'                <div class="carousel-overlay"></div>' +
'                <div class="hero-content">' +
'                    <h2>' + slide4.heading + '</h2>' +
'                    <p>' + slide4.desc + '</p>' +
'                    <a href="#contact" class="btn btn-primary">' + slide4.btn + '</a>' +
'                </div>' +
'            </div>' +
'        </div>' +
'        <div class="carousel-nav">' +
'            <button class="carousel-prev"><i class="fas fa-chevron-left"></i></button>' +
'            <button class="carousel-next"><i class="fas fa-chevron-right"></i></button>' +
'        </div>' +
'        <div class="carousel-indicators">' +
'            <span class="indicator active" data-slide="0"></span>' +
'            <span class="indicator" data-slide="1"></span>' +
'            <span class="indicator" data-slide="2"></span>' +
'            <span class="indicator" data-slide="3"></span>' +
'        </div>' +
'    </section>' +

'    <!-- Services Section -->' +
'    <section id="services" class="services">' +
'        <div class="container">' +
'            <h2 class="section-title">Our Services</h2>' +
'            <div class="services-grid">' +
'                <div class="service-card">' +
'                    <i class="fas fa-map-marked-alt"></i>' +
'                    <h3>Land Surveying</h3>' +
'                    <p>Accurate topographical surveys, boundary surveys, and cadastral mapping using state-of-the-art equipment.</p>' +
'                </div>' +
'                <div class="service-card">' +
'                    <i class="fas fa-city"></i>' +
'                    <h3>Physical Planning</h3>' +
'                    <p>Comprehensive urban and regional planning services for sustainable development projects.</p>' +
'                </div>' +
'                <div class="service-card">' +
'                    <i class="fas fa-globe-africa"></i>' +
'                    <h3>GIS Mapping</h3>' +
'                    <p>Geographic Information System solutions for spatial data analysis and visualization.</p>' +
'                </div>' +
'                <div class="service-card">' +
'                    <i class="fas fa-home"></i>' +
'                    <h3>Property Subdivision</h3>' +
'                    <p>Expert subdivision planning and approval processing for residential and commercial properties.</p>' +
'                </div>' +
'                <div class="service-card">' +
'                    <i class="fas fa-file-alt"></i>' +
'                    <h3>Land Documentation</h3>' +
'                    <p>Complete land documentation services including title deeds and land registration.</p>' +
'                </div>' +
'            </div>' +
'        </div>' +
'    </section>' +

'    <!-- About Section -->' +
'    <section id="about" class="about">' +
'        <div class="container">' +
'            <h2 class="section-title">About ' + companyName + '</h2>' +
'            <div class="about-content">' +
'                <div class="about-text">' +
'                    <p>' + aboutText1 + '</p>' +
'                    <p>' + aboutText2 + '</p>' +
'                    <div class="stats">' +
'                        <div class="stat">' +
'                            <h3>500+</h3>' +
'                            <p>Projects Completed</p>' +
'                        </div>' +
'                        <div class="stat">' +
'                            <h3>15+</h3>' +
'                            <p>Years Experience</p>' +
'                        </div>' +
'                        <div class="stat">' +
'                            <h3>100%</h3>' +
'                            <p>Client Satisfaction</p>' +
'                        </div>' +
'                    </div>' +
'                </div>' +
'            </div>' +
'        </div>' +
'    </section>' +

'    <!-- Contact Section -->' +
'    <section id="contact" class="contact">' +
'        <div class="container">' +
'            <h2 class="section-title">Get In Touch</h2>' +
'            <div class="contact-content">' +
'                <div class="contact-info">' +
'                    <h3>Contact Information</h3>' +
'                    <div class="info-item">' +
'                        <i class="fas fa-map-marker-alt"></i>' +
'                        <p>' + location + '</p>' +
'                    </div>' +
'                    <div class="info-item">' +
'                        <i class="fas fa-phone"></i>' +
'                        <p>' + phone + '</p>' +
'                    </div>' +
'                    <div class="info-item">' +
'                        <i class="fas fa-envelope"></i>' +
'                        <p>' + email + '</p>' +
'                    </div>' +
'                    <div class="info-item">' +
'                        <i class="fas fa-clock"></i>' +
'                        <p>' + hours + '</p>' +
'                    </div>' +
'                </div>' +
'                <form class="contact-form" id="contactForm">' +
'                    <h3>Send Us a Message</h3>' +
'                    <div class="form-group">' +
'                        <input type="text" name="name" id="contactName" placeholder="Your Name" required>' +
'                    </div>' +
'                    <div class="form-group">' +
'                        <input type="email" name="email" id="contactEmail" placeholder="Your Email" required>' +
'                    </div>' +
'                    <div class="form-group">' +
'                        <input type="tel" name="phone" id="contactPhone" placeholder="Your Phone">' +
'                    </div>' +
'                    <div class="form-group">' +
'                        <select name="service" id="contactService" required>' +
'                            <option value="">Select Service</option>' +
'                            <option value="land-survey">Land Surveying</option>' +
'                            <option value="planning">Physical Planning</option>' +
'                            <option value="gis">GIS Mapping</option>' +
'                            <option value="subdivision">Property Subdivision</option>' +
'                            <option value="documentation">Land Documentation</option>' +
'                        </select>' +
'                    </div>' +
'                    <div class="form-group">' +
'                        <textarea name="message" id="contactMessage" placeholder="Your Message" rows="5" required></textarea>' +
'                    </div>' +
'                    <button type="submit" class="btn btn-primary" id="submitBtn">' +
'                        <span class="btn-text">Send Message</span>' +
'                        <span class="btn-loading" style="display: none;">Sending...</span>' +
'                    </button>' +
'                </form>' +
'            </div>' +
'        </div>' +
'    </section>' +

'    <!-- Footer -->' +
'    <footer>' +
'        <div class="container">' +
'            <div class="footer-content">' +
'                <div class="footer-section">' +
'                    <h4>' + companyName + '</h4>' +
'                    <p>Your trusted partner in land survey and physical planning services.</p>' +
'                    <div class="social-links">' +
'                        <a href="#"><i class="fab fa-facebook"></i></a>' +
'                        <a href="#"><i class="fab fa-twitter"></i></a>' +
'                        <a href="#"><i class="fab fa-linkedin"></i></a>' +
'                        <a href="#"><i class="fab fa-instagram"></i></a>' +
'                    </div>' +
'                </div>' +
'                <div class="footer-section">' +
'                    <h4>Quick Links</h4>' +
'                    <ul>' +
'                        <li><a href="#home">Home</a></li>' +
'                        <li><a href="#services">Services</a></li>' +
'                        <li><a href="#about">About Us</a></li>' +
'                        <li><a href="#contact">Contact</a></li>' +
'                    </ul>' +
'                </div>' +
'                <div class="footer-section">' +
'                    <h4>Our Services</h4>' +
'                    <ul>' +
'                        <li><a href="#services">Land Surveying</a></li>' +
'                        <li><a href="#services">Physical Planning</a></li>' +
'                        <li><a href="#services">GIS Mapping</a></li>' +
'                        <li><a href="#services">Property Subdivision</a></li>' +
'                    </ul>' +
'                </div>' +
'            </div>' +
'            <div class="footer-bottom">' +
'                <p>&copy; 2024 ' + companyName + '. All rights reserved.</p>' +
'            </div>' +
'        </div>' +
'    </footer>' +

'    <script src="js/script.js"></script>' +
'</body>' +
'</html>';
        }

        function generateCarouselUpdates(data) {
            let updates = '';
            for (let i = 1; i <= 4; i++) {
                if (data[`carouselImage${i}`]) {
                    updates += `
    // Update carousel slide ${i}
    const slide${i} = document.querySelectorAll('.carousel-slide')[${i-1}];
    if (slide${i}) {
        slide${i}.style.backgroundImage = "url('${data[`carouselImage${i}`]}')";
        const content${i} = slide${i}.querySelector('.hero-content');
        if (content${i}) {
            content${i}.querySelector('h2').textContent = "${data[`carouselHeading${i}`] || ''}";
            content${i}.querySelector('p').textContent = "${data[`carouselDesc${i}`] || ''}";
            content${i}.querySelector('.btn').textContent = "${data[`carouselBtn${i}`] || ''}";
        }
    }
`;
                }
            }
            return updates;
        }

        function generateContentUpdates(data) {
            let updates = '';
            
            if (data.companyName) {
                updates += `
    // Update company name
    document.querySelectorAll('.nav-brand h1').forEach(el => el.textContent = "${data.companyName}");
`;
            }
            
            if (data.aboutText1 || data.aboutText2) {
                updates += `
    // Update about text
    const aboutParagraphs = document.querySelectorAll('.about-text p');
    if (aboutParagraphs[0]) aboutParagraphs[0].textContent = "${data.aboutText1 || ''}";
    if (aboutParagraphs[1]) aboutParagraphs[1].textContent = "${data.aboutText2 || ''}";
`;
            }
            
            // Add contact info updates
            const contactFields = ['location', 'phone', 'email', 'hours'];
            contactFields.forEach((field, index) => {
                if (data[field]) {
                    updates += `
    // Update ${field}
    const ${field}El = document.querySelectorAll('.info-item p')[${index}];
    if (${field}El) ${field}El.textContent = "${data[field]}";
`;
                }
            });
            
            return updates;
        }
    </script>
</body>
</html>